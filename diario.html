<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Diario</title>
  <!-- HTML -->
</head>

<body>
  <div id="entrada">
  </div>
  <input type="date" name="fecha" id="fecha" value="0783-07-07" />
  <!-- <input type="datetime-local" name="fecha" id="fecha" value="0183-11-18T00:27" /> -->
  <input type="checkbox" name="cbFecha" id="cbFecha" onclick='buscar(this.checked);'>
  <label for="cbFecha"> Buscar fechas</label><br>

  <button onclick="cargar()">cargar</button>
  <button onclick="formatear()">añadir</button>
  <button onclick=" fo()">H2</button>
  <button onclick=" formatearPersonaje()">Personajes</button>
  <textarea name="text" autocomplete="true" rows=10 id="texto" style="width:96%;padding:2%;font:15px sans-serif;">
    </textarea>

  <div id="diario">
  </div>
  <div id="diario">

  </div>
  <div id="Personajes">
    <h2 id="Nethmorlug">Nethmorlug</h2>
    Nethmorlug, es el verdadero nombre del padre de Rosssel. Significa “joven dragón negro”, y poco a poco ha ido
    dejando
    de utilizarlo conforme ha ido aceptando su condición de humano.
    Nethmorlug era un joven, pero poderoso dragón, de una legendaria estirpe de dragones negros cuando se cruzó en su
    camino el nigromante Felugûl. Este poderoso brujo consiguió lanzar una poderosa maldición sobre Nethmorlug,
    convirtiéndolo en humano. La única manera de lograr dejar de serlo sería auto inmolándose ante el mago, que lograría
    el poder de convertirse en dragón.
    En su inútil huida del nigromante conoció a Oðuwen, una bellísima joven con unos poderes mágicos innatos
    extraordinarios; hija de una séptima hija. Rosssel fue el fruto de su relación.
    <h2 id="Ragnar Sigurdsson">Ragnar Sigurdsson</h2>
    Ragnar es un jarl de Nordö. Su esposa y él acogieron a Rosssel como una hija cuando huía del nigromante dado el
    parecido de ésta con su hija muerta. Posee una pequeña flota con la que asola las costas del continente en la
    estación
    estival
    <h2 id="Skulug">Skulug</h2>
    Es el nombre que adoptó Nethmorlug cuando comenzó a convivir con humanos; su significado es “Dragón maldito”. Como
    humano se convirtió en un excelso espadachín y consiguió la espada Naskelug (Colmillo de drágon), una de las mejores
    obras del legendario herrero nórdico, Ulfberht.
    <h2 id="Oðuwen">Oðuwen</h2>
    Hija de una séptima hija, sus imponentes habilidades mágicas innatas marcaron su vida. Desde muy pequeña, sin haber
    recibido ningún tipo de instrucción mágica, consiguió domeñar la magia sin conocer hechizos. Una de Las hechiceras
    libres, Zinaida, la encontró y la tuteló en el uso de la magia; insistió en que se convirtiera en una de ellas y
    fuese
    a instruirse en su famosa torre, pero Oðuwen no quería separarse de su familia para irse a una tierra lejana y
    extraña.
    <h2 id="Felugûl">Felugûl</h2>
    Poco se sabe sobre los orígenes de este archinigromante. La leyenda y la verdad se entremezclan en oscuras historias
    sobre atroces sacrificios humanos de los que un joven y ambicioso brujo obtuvo un gran poder. Lo que sí se sabe es
    que
    fue discípulo del viejo nigromante Abdul Alhazred, también que estaba a su lado cuando éste murió y aunque ya
    contaba
    con varias centurias se sospecha que no sucedió de forma natural. Hay leyendas sobre que este joven mago se quedó
    con
    el poder de su maestro además de con todas sus posesiones.
    <h2 id="Las hechiceras libres">Las hechiceras libres</h2>
    Las hechiceras libres (السحرة مجانا ) es el nombre de un grupo de hechiceras surgidas en Bedarol. En sus comienzos
    fue
    un grupo totalmente secreto creado por la hechicera Wajeha Al-Huwaider, la séptima hija de una séptima hija. Creó
    una
    fabulosa torre donde poder dedicarse al estudio de la magia. Con el paso del tiempo fue aceptando mujeres como
    aprendices, enseñándoles su vasta sabiduría arcana.
    <h2 id="Zinaida"> Zinaida</h2>
    Es una hechicera libre de las lejanas tierras de Bedarol. Fue una de las primeras en unirse a Wajeha en el recién
    creado grupo de hechiceras libres. Desde el principio le gustó encargarse de buscar nuevas adeptas que pudiesen
    ingresar en la hermandad. Recorrió de norte a sur y de este a oeste las tierras de Elahiun en su incansable búsqueda
    de mujeres dotadas para la magia que no tuviesen acceso a su aprendizaje. En unos de sus múltiples periplos se
    encontró con Oðuwen. Impresionada con las capacidades mágicas de ésta intentó convencerla de que se uniese a la
    hermandad y cuando ésta se negó, Zinaida dejó de lado sus viajes para quedarse con ella y enseñarle los arcanos de
    la
    magia. También le regaló el Compendio de magia Gaselum Melester; un excepcional libro de magia para que pudiera
    seguir
    estudiando y aprendiendo nuevas habilidades y hechizos cuando Zinaida se fuera.
    <h2 id="Snjór">Snjór</h2>
    Mientras Rosssel se escondía en una cueva (5-7-783), intentando que un gigante no la encontrase, encontró a un
    pequeño
    cachorro de wargo desvalido. Se hizo cargo de él y lo llamó <a href="#Snjór">Snjór</a><a href="#7-7-783">(7-7-783).
    </a><a href="#Snjór">Snjór</a>es un excepcional ejemplar de wargo gigante de las nieves con un inmaculado pelaje
    blanco.
    <h2 id="Niweleshtor">Niweleshtor</h2>
    Es un excepcional tigre alado (leshtor) de una insólita capa negra. Su poder y sabiduría son proverbiales entre los
    leshtor. Es amigo de Skasendor desde hace siglos y juntos han vivido muchas aventuras, prestándose apoyo mutuamente
    en
    las situaciones más complicadas. Ambos tienen un vínculo telépatico que les permite solicitar la ayuda del otro en
    caso de necesidad.
    <h2 id="Lanawin">Lanawin</h2>
    Lanawin es un tigre alado (leshtor) que fue separado de sus padres por un grupo de cazadores que los asesinaron para
    hacerse con él y conseguir una gran cantidad de dinero al venderlo. Skasendor y Rosssel lo salvaron del poder de sus
    captores, a los que mataron para que ningún ser humano pudiese volver acceder a hábitat de los tigres alados
    (4-8-783). El pequeño cachorro se encariñó con ellos, sobre todo con Rosssel; y Niweleshtor, viendo el cariño que el
    pequeño tigre mostraba por ellos, accedió a que lo adoptasen. Al llegar a Enolsendor congenió perfectamente con el
    pequeño wargo <a href="#Snjór">Snjór</a> Lanawin es un precioso cachorro de tigre volador blanco con rayas negras.
    <h2 id="Tretogor">Tretogor</h2>
    Bajo la apariencia de un viejo cascarrabias se esconde uno de los magos más poderosos y longevos. Este poderoso
    hechicero, que ha visto sucederse los siglos desde su aislada torre, perdida en los confines del mundo, es la máxima
    autoridad en materia de encantamientos. Se especializó en ellos tras dominar los secretos de otros arcanos de la
    magia. Es famoso tanto por sus poderosos encantamientos como por su legendario aislamiento, siendo uno de los pocos
    magos que nunca ha aceptado un aprendiz. Bajo la máscara del excéntrico y huraño mago apartado del mundo se esconde
    un
    entrañable anciano. Gran amigo de Skasendor, es una de las pocas personas del mundo con las que tiene trato. En los
    últimos siglos se ha relacionado más con los leshtor que con los humanos.
  </div>
  <!-- Project -->
  <script type="text/javascript" charset="utf-8">
    var links = []
    var fechas = []
    var buscarFecha = false;
    cargar()

    function foo() {
      var selObj = window.getSelection();
      alert(selObj);
      var selRange = selObj.getRangeAt(0);
      console.log(selRange);
      // do stuff with the range
    }

    function fo( ) {
      var el = document.getElementById('texto')
  var s = window.getSelection().toString();
  const [start, end] = [el.selectionStart, el.selectionEnd];
  el.setRangeText(`<h2 id='${s}'>${s}</h2>`, start, end, 'select');
}

    function buscar(b) {
      buscarFecha = b;
      console.log(buscarFecha);
    }

    function cargar(hx = 'h2') {
      let h = document.getElementsByTagName(hx)
      //console.log(h);
      links = []
      for (l in h) {
        let n = (h[l].innerText);
        if (n) {
          if (n.match(/(\d{1,2}-\d{1,2}-\d{3,4})/))
            fechas.push(n)
          else
            links.push(n)
          console.log(n);
        }
      }
      document.getElementById('entrada').innerHTML = links
    }

    var fecha
    function formatear(arg) {
      // body...
      let t =
        document.getElementById('texto').value
      links.forEach((l) => t = t.replace(l,
        `<a href="#${l}">${l}</a>`
      ))


      fechas.forEach((l) => {
        var replace = `(${l})([^\n])`;
        var re = new RegExp(replace, "g");
        t = t.replace(re,
          `<a href="#$1">$1</a>$2`)
        // `<a href="#${l}">${l}</a>`)

      }
      )

      if (buscarFecha) {
        t = formatearFecha(t);
        document.getElementById('diario').innerHTML += t
      }
      else {

        let f =
          document.getElementById('fecha').value
        fecha = new Date(f);
        var sfecha = fecha.getDate() + '/' +
          (fecha.getMonth() + 1) + '/' + fecha.getFullYear()
        console.log(sfecha);
        //   document.getElementById('entrada').innerHTML=`<h2 id='${f}'>${f}</h2>`+t
        // console.log(f);
        document.getElementById('diario').innerHTML += `<h2 id='${sfecha}' >${sfecha}</h2>` + t
      }


    }

    function formatearFecha(s) {
      let t = s;
      t = t.replace(/(\d{1,2}-\d{1,2}-\d{3,4})\n/g,
        `<h2 id='$1'>$1</h2>`);
      return t;
    }

    function formatearPersonaje(s= document.getElementById('texto').value) {
      let t = s;
      console.log(t.match(/\n([\p{L}\s]+)\n/gu));
      t = t.replace(/\n([\p{L}\s]+)\n/gu,
        `<h2 id='$1'>$1</h2>`);

        

        document.getElementById('Personajes').innerHTML += t
      return t;
    }


    console.log(formatearFecha('11-11-777\n11-13-777\n14-11-777'));

  </script>
</body>

</html>