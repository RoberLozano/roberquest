<!DOCTYPE html>
<html>
<head>
        <meta charset='utf-8'>

<title>Importar Datos</title>

<script src="https://www.gstatic.com/firebasejs/4.7.0/firebase.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src='habilidades.js'></script>
<script src='inventario.js'></script>
<script src='rol.js'></script>
</head>
<body>

<h1>Importar Habilidades</h1>
<input type="text" class="text-light bg-dark h3 " id="nombre">
<p>Introduzca los datos en la caja de texto</p>
    <textarea  id = "datos" name="text" rows =30 id="text"  style="width:96%;padding:2%;font:15px sans-serif;">

    </textarea>
    <button onclick="scan()">Scan</button>
    <textarea placeholder="Describe yourself here..."></textarea> 

    <script>
        var listaHabilidades=[];
        var tipo="Agilidad";
        let nombre = document.getElementById("nombre");
        nombre.value=pj.nombre;

        function limpiar(){
        }

        function scan(params) {
            var datos = document.getElementById("datos");
            var texto= datos.value;
            var lineas = texto.split("\n");
            lineas.forEach(linea => {
               porLinea(linea,"\t")
            });
            // console.log(listaHabilidades);
            pj.nombre=nombre = $("#nombre").val();
            console.log(pj);
            

        }

        function porLinea(linea, separador=";"){
            if(linea.startsWith(separador)||linea.startsWith("_")) return; // si la linea no tiene nombre se vuelve o si empieza en ___
            var h = linea.split(separador, 3); //nombre,xp,valor
            let nombre=h[0]
            console.log("|"+nombre+"|");
            if(nombre.toUpperCase().startsWith("HABILIDADES DE ")){       //si empieza por "HABILIDADES DE " sin que importen las mayúsculas
                nombre=nombre.replace(/habilidades de /gi, "");// guardo solo el tipo de habilidad sin que importen las mayúsculas
                tipo=capitalice(nombre);                    // 1 en mayusculas
            }
            else{
                var habilidad = new Habilidad(h[0], tipo, parseInt(h[2]));
                if(h[1]==="") h[1]=0;
                habilidad.xp=parseInt(h[1]);
                // listaHabilidades.push(habilidad);
                pj.setHabilidad(habilidad);
                habilidad.save();
            }


        }

        
function capitalice(string) 
{
    return string.charAt(0).toUpperCase() + string.toLowerCase().slice(1);
}

    </script>
</body>
</html> 